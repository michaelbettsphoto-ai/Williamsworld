<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Williams World - Quest Tracker</title>
</head>
<body>

<style>
  :root{
    --bg0:#070b16; --bg1:#0b1020; --panel:#0f1730cc; --ink:#eaf0ff; --muted:#b9c6ffcc;
    --line:#26345f; --gold:#ffd36e; --green:#7dffb4; --blue:#7aa2ff;
    --shadow:0 18px 60px rgba(0,0,0,.45); --r1:22px; --r2:16px; --pad:16px; --max:1080px;
    --font:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  }
  #ww{font-family:var(--font); color:var(--ink);}
  #ww *{box-sizing:border-box}
  #ww .wrap{max-width:var(--max); margin:0 auto; padding:14px}
  #ww .topbar{
    position:sticky; top:0; z-index:60;
    background: linear-gradient(180deg, rgba(7,11,22,.96), rgba(7,11,22,.78));
    backdrop-filter: blur(10px);
    border:1px solid rgba(38,52,95,.55);
    border-radius:18px;
    padding:10px 12px;
  }
  #ww .topbar-inner{display:flex; gap:12px; justify-content:space-between; align-items:center; flex-wrap:wrap}
  #ww .brand{display:flex; gap:10px; align-items:center; font-weight:950}
  #ww .logoMark{width:34px; height:34px; border-radius:12px; border:1px solid rgba(122,162,255,.55); overflow:hidden}
  #ww .logoMark img{width:100%;height:100%;object-fit:cover;display:block}
  #ww .badge{font-size:12px; padding:4px 9px; border:1px solid rgba(122,162,255,.45); color:var(--muted); border-radius:999px; background: rgba(122,162,255,.10); font-weight:800}
  #ww .nav{display:flex; gap:8px; flex-wrap:wrap}
  #ww .nav button{
    border:1px solid rgba(38,52,95,.85); background: rgba(15,23,48,.55); color:var(--ink);
    padding:8px 10px; border-radius:999px; cursor:pointer; font-weight:850; font-size:13px;
  }
  #ww .nav button.active{background: rgba(122,162,255,.18); border-color: rgba(122,162,255,.75)}
  #ww .banner{
    margin-top:12px; border-radius:26px; border:1px solid rgba(38,52,95,.65);
    box-shadow:var(--shadow); overflow:hidden; position:relative;
    background: linear-gradient(180deg, rgba(17,26,51,.80), rgba(11,16,32,.55));
    min-height: 340px;
  }
  #ww .banner-inner{padding:18px; display:grid; grid-template-columns: 1.25fr .75fr; gap:14px}
  @media (max-width:980px){ #ww .banner-inner{grid-template-columns:1fr} }
  #ww h1{margin:0 0 6px; font-size:28px; font-weight:1000}
  #ww p{margin:0; color:var(--muted); font-weight:650}
  #ww .ctaRow{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}
  #ww .btn{
    border:1px solid rgba(38,52,95,.95); background: rgba(11,16,32,.28); color:var(--ink);
    padding:10px 12px; border-radius:14px; cursor:pointer; font-weight:950; font-size:13px;
  }
  #ww .btn.primary{background: rgba(122,162,255,.18); border-color: rgba(122,162,255,.8)}
  #ww .btn.gold{background: rgba(255,211,110,.14); border-color: rgba(255,211,110,.65)}
  #ww .btn.danger{background: rgba(255,107,138,.10); border-color: rgba(255,107,138,.55)}
  #ww .statRow{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}
  #ww .pill{border:1px solid rgba(38,52,95,.85); background: rgba(7,11,22,.28); border-radius:999px; padding:8px 10px; display:flex; gap:8px; align-items:center; font-weight:900; font-size:13px}
  #ww .dot{width:10px;height:10px;border-radius:999px;background:var(--blue)}
  #ww .dot.green{background:var(--green)}
  #ww .dot.gold{background:var(--gold)}
  #ww .meter{border:1px solid rgba(38,52,95,.75); border-radius:14px; background: rgba(7,11,22,.22); padding:10px; margin-top:10px}
  #ww .meterTop{display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; margin-bottom:8px}
  #ww .small{font-size:12px; color:var(--muted); font-weight:650}
  #ww .bar{height:12px;border-radius:999px;background: rgba(38,52,95,.55);overflow:hidden;border:1px solid rgba(38,52,95,.85)}
  #ww .bar > div{height:100%; width:0%; background: linear-gradient(90deg, rgba(122,162,255,.95), rgba(125,255,180,.95)); transition: width .25s ease}
  #ww .grid{margin-top:14px; display:grid; grid-template-columns:1fr 1fr; gap:14px}
  @media (max-width:980px){ #ww .grid{grid-template-columns:1fr} }
  #ww .card{border:1px solid rgba(38,52,95,.70); background: rgba(15,23,48,.62); border-radius:var(--r1); box-shadow:var(--shadow); padding:var(--pad)}
  #ww .card h2{margin:0 0 10px; font-size:15px; display:flex; justify-content:space-between; align-items:center; gap:10px}
  #ww .tag{font-size:12px; padding:6px 10px; border-radius:999px; border:1px solid rgba(38,52,95,.75); background: rgba(15,23,48,.45); color:var(--muted); font-weight:900}
  #ww .frame{border:1px solid rgba(38,52,95,.60); background: rgba(7,11,22,.22); border-radius:var(--r2); padding:12px}
  #ww .taskList{display:grid; gap:10px; margin-top:10px}
  #ww .task{display:grid; grid-template-columns:28px 1fr auto; gap:10px; align-items:center; border:1px solid rgba(38,52,95,.58); background: rgba(11,16,32,.20); border-radius:16px; padding:10px}
  #ww .task input{width:20px;height:20px; accent-color: var(--green)}
  #ww .task .name{font-weight:950}
  #ww .task .xp{font-weight:1000; padding:6px 9px; border-radius:999px; border:1px solid rgba(125,255,180,.45); background: rgba(125,255,180,.10); font-size:12px; min-width:74px; text-align:center}
  #ww .party{display:grid; grid-template-columns:repeat(3, 1fr); gap:10px; margin-top:10px}
  @media (max-width:520px){ #ww .party{grid-template-columns:1fr} }
  #ww .creature{border:1px solid rgba(38,52,95,.60); background: rgba(7,11,22,.22); border-radius:16px; padding:10px; display:flex; gap:10px; align-items:center}
  #ww .avatar{width:42px;height:42px;border-radius:16px;border:1px solid rgba(38,52,95,.70);overflow:hidden}
  #ww .avatar img{width:100%;height:100%;object-fit:cover;display:block}
  #ww .map{display:grid; gap:10px; margin-top:10px}
  #ww .node{border:1px solid rgba(38,52,95,.58); background: rgba(7,11,22,.22); border-radius:16px; padding:10px; display:flex; justify-content:space-between; align-items:center; gap:10px}
  #ww .node .left{display:flex; gap:10px; align-items:center}
  #ww .node .icon{width:36px;height:36px;border-radius:14px;border:1px solid rgba(38,52,95,.70); overflow:hidden}
  #ww .node .icon img{width:100%;height:100%;object-fit:cover;display:block}
  #ww .toast{position:fixed; left:50%; bottom:16px; transform:translateX(-50%); background: rgba(15,23,48,.92);
    border:1px solid rgba(122,162,255,.6); padding:10px 12px; border-radius:14px; box-shadow:var(--shadow); display:none; z-index:999; font-weight:900}
</style>

<div id="ww">
  <div class="wrap">
    <div class="topbar">
      <div class="topbar-inner">
        <div class="brand">
          <div class="logoMark"><img id="logoImg" alt="Williams World"></div>
          <div>
            <div>Williams World</div>
            <div class="small">Quest UI ‚Ä¢ daily wins ‚Üí XP ‚Üí levels ‚Üí streak rewards</div>
          </div>
          <span class="badge" id="todayLabel">Today</span>
        </div>
        <div class="nav">
          <button class="active" data-section="home">Home</button>
          <button data-section="tracker">Tracker</button>
          <button data-section="party">Party</button>
          <button data-section="map">Map</button>
        </div>
      </div>
    </div>

    <section class="banner" data-banner id="home">
      <div class="banner-inner">
        <div>
          <h1>Start Adventure Mode</h1>
          <p>This "game" turns routines into quests. Complete steps ‚Üí earn XP ‚Üí level up ‚Üí keep a PASS streak.</p>

          <div class="ctaRow">
            <button class="btn primary" id="goTracker">‚öîÔ∏è Start Today's Tracker</button>
            <button class="btn gold" id="gradeDay">üèÜ Grade Today</button>
            <button class="btn danger" id="resetToday">üßΩ Reset Today</button>
          </div>

          <div class="statRow">
            <div class="pill"><span class="dot"></span> Level <span id="levelNum">1</span></div>
            <div class="pill"><span class="dot green"></span> Streak <span id="streakNum">0</span> nights</div>
            <div class="pill"><span class="dot gold"></span> Today: <span id="dayResult">Not graded</span></div>
          </div>

          <div class="meter">
            <div class="meterTop">
              <div><b>XP</b>: <span id="xpNow">0</span> / <span id="xpNext">100</span></div>
              <div class="small">PASS rule: all Night-Before + Trapper Check</div>
            </div>
            <div class="bar"><div id="xpBar"></div></div>
          </div>
        </div>

        <div class="card" style="margin:0;">
          <h2>Current Quest <span class="tag">DAILY</span></h2>
          <div class="frame" style="padding:0; overflow:hidden; margin-bottom:10px;">
            <img id="mapstripImg" alt="World Map Strip" style="width:100%;height:auto;display:block;">
          </div>
          <div class="frame">
            <div style="display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;align-items:center;">
              <div style="font-weight:1000;">Quest Target</div>
              <div class="tag">PASS = Night-Before + Trapper</div>
            </div>
            <div class="small" style="margin-top:8px;">Do the first checkbox. Then the next.</div>
          </div>
        </div>
      </div>
    </section>

    <div class="grid">
      <section class="card" id="tracker">
        <h2>Daily Checklist <span class="tag">XP + Streak</span></h2>
        <div class="frame"><div class="small"><b>PASS rule:</b> all Night-Before tasks + Trapper Check complete.</div></div>
        <div class="taskList" id="taskList"></div>
      </section>

      <section class="card" id="party">
        <h2>Party Team <span class="tag">Companions</span></h2>
        <div class="party">
          <div class="creature"><div class="avatar"><img id="emberImg" alt="Ember"></div><div><b>Ember Tiger</b><div class="small">Start Fast</div></div></div>
          <div class="creature"><div class="avatar"><img id="spriteImg" alt="Sprite"></div><div><b>Focus Sprite</b><div class="small">Night Wins</div></div></div>
          <div class="creature"><div class="avatar"><img id="golemImg" alt="Golem"></div><div><b>Pack Golem</b><div class="small">Prepared</div></div></div>
        </div>
      </section>

      <section class="card" id="map">
        <h2>World Map <span class="tag">Zones</span></h2>
        <p class="small">Unlock zones by keeping a PASS streak.</p>
        <div class="map" id="mapNodes"></div>
      </section>

      <section class="card">
        <h2>Rewards <span class="tag">5 PASS nights</span></h2>
        <div class="frame"><div class="small" id="rewardStatus">Need 5 PASS nights.</div></div>
      </section>
    </div>
  </div>

  <div class="toast" id="toast"></div>
</div>

<script>
  const driveImg = (id) => `https://drive.google.com/uc?export=view&id=${id}`;

  const ASSETS = {
    mapstrip: driveImg("1uRnf1lRrckwCio65JR4uoqLMJqdgTy3l"),
    banner:   driveImg("1alP63TrXq74YiS1anmtcKXicjwt2l5_6"),
    logo:     driveImg("10saxE0g59l5xok5O0pCRCu1JOQy3NlXb"),
    companions: {
      ember:  driveImg("1HCOGXn6fncfUGR9-wwwAoNB8DDQ_D-fN"),
      sprite: driveImg("1bFthyxEFXuOgoGmDtgFNOQRm0diESurv"),
      golem:  driveImg("1UBt7S_b51y8TscjiwN4go55iux0mRoL8"),
    },
    zones: {
      z1: driveImg("1khkAGTYaqs2kcV47QlywWJV8nx6DCPT3"),
      z2: driveImg("1Gqf9RB81VfNXhJTNGpZrqnGcnEq-gkCG"),
      z3: driveImg("1QUjRAL_25vraSxiAUwh6DEi0VFZcUzvf"),
      z4: driveImg("12nyjV7zm_bEzG2uDgPy6tv1Uo2rLZ5Gd"),
    }
  };

  const KEY = "williams_world_embed_state_v1";
  const TASKS = [
    { id:"m_prayer",   label:"Morning: Prayer / Quiet Moment (1 min)", xp:10 },
    { id:"m_breakfast",label:"Morning: Breakfast (eat + drink)", xp:10 },
    { id:"m_dressed",  label:"Morning: Get dressed (full outfit)", xp:10 },
    { id:"m_teeth",    label:"Morning: Brush teeth", xp:10 },
    { id:"m_hair",     label:"Morning: Brush hair", xp:10 },
    { id:"m_trappercheck", label:"Morning: Backpack/Trapper check", xp:15 },
    { id:"n_clothes",  label:"Night-Before: Clothes ready", xp:15 },
    { id:"n_pack",     label:"Night-Before: Backpack packed", xp:15 },
    { id:"n_trapper",  label:"Night-Before: Trapper ready", xp:20 },
    { id:"n_teeth",    label:"Night-Before: Brush teeth", xp:15 },
    { id:"n_bedtime",  label:"Night-Before: Bedtime routine done", xp:20 },
  ];

  const MAP = [
    { id:"z1", title:"Zone 1: Launch Meadow", need:1 },
    { id:"z2", title:"Zone 2: Homework Hills", need:3 },
    { id:"z3", title:"Zone 3: Backpack Bastion", need:5 },
    { id:"z4", title:"Zone 4: Focus Forest", need:10 },
  ];

  const $ = (id)=>document.getElementById(id);
  const todayKey = ()=>{
    const d=new Date(); return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`;
  };
  const prettyToday = ()=>new Date().toLocaleDateString(undefined,{weekday:"short",month:"short",day:"numeric"});

  const xpForLevel = (lvl)=> 100 + (lvl-1)*20;

  function load(){
    try{
      const raw = localStorage.getItem(KEY);
      if(!raw) throw 0;
      return JSON.parse(raw);
    }catch{
      return { xp:0, level:1, streak:0, days:{} };
    }
  }
  function save(){ localStorage.setItem(KEY, JSON.stringify(state)); }

  function toast(msg){
    const el=$("toast"); el.textContent=msg; el.style.display="block";
    clearTimeout(toast._t); toast._t=setTimeout(()=>el.style.display="none", 1800);
  }

  function applyAssets(){
    const bannerEl = document.querySelector("#ww [data-banner]");
    if(bannerEl){
      bannerEl.style.background =
        `linear-gradient(180deg, rgba(7,11,22,.55), rgba(7,11,22,.78)),
         url("${ASSETS.banner}") center/cover no-repeat`;
    }
    $("logoImg").src = ASSETS.logo;
    $("mapstripImg").src = ASSETS.mapstrip;
    $("emberImg").src = ASSETS.companions.ember;
    $("spriteImg").src = ASSETS.companions.sprite;
    $("golemImg").src = ASSETS.companions.golem;
  }

  let state = load();
  const TODAY = todayKey();
  if(!state.days[TODAY]){
    state.days[TODAY]={ tasks:Object.fromEntries(TASKS.map(t=>[t.id,false])), result:"Not graded" };
    save();
  }

  function isPassDay(){
    const day = state.days[TODAY];
    const nightIds = ["n_clothes","n_pack","n_trapper","n_teeth","n_bedtime"];
    const trap = day.tasks["m_trappercheck"] === true;
    const nightOk = nightIds.every(id=>day.tasks[id]===true);
    return nightOk && trap;
  }

  function recalcLevel(){
    while(state.xp >= xpForLevel(state.level)){
      state.xp -= xpForLevel(state.level);
      state.level += 1;
      toast(`LEVEL UP ‚Üí ${state.level}`);
    }
  }

  function updateHeader(){
    $("todayLabel").textContent = prettyToday();
    $("levelNum").textContent = state.level;
    $("streakNum").textContent = state.streak;

    const need = xpForLevel(state.level);
    $("xpNow").textContent = state.xp;
    $("xpNext").textContent = need;
    $("xpBar").style.width = Math.max(0, Math.min(100, Math.round((state.xp/need)*100))) + "%";

    $("dayResult").textContent = state.days[TODAY].result;
    $("rewardStatus").textContent = state.streak >= 5 ? "Reward ready üéÅ" : `Need ${5-state.streak} more PASS night(s).`;
  }

  function renderTasks(){
    const day = state.days[TODAY];
    const list = $("taskList");
    list.innerHTML = "";
    TASKS.forEach(t=>{
      const row=document.createElement("div");
      row.className="task";
      row.innerHTML = `
        <input type="checkbox" ${day.tasks[t.id]?"checked":""}>
        <div class="name"></div>
        <div class="xp">+${t.xp} XP</div>
      `;
      row.querySelector(".name").textContent = t.label;

      const cb=row.querySelector("input");
      cb.addEventListener("change", ()=>{
        const was = day.tasks[t.id]===true;
        day.tasks[t.id] = cb.checked;

        if(!was && cb.checked){ state.xp += t.xp; recalcLevel(); toast(`+${t.xp} XP`); }
        day.result="Not graded";
        save();
        updateHeader();
        renderMap();
      });

      list.appendChild(row);
    });
  }

  function renderMap(){
    const el=$("mapNodes"); el.innerHTML="";
    MAP.forEach(z=>{
      const unlocked = state.streak >= z.need;

      const node=document.createElement("div");
      node.className="node";

      const left=document.createElement("div"); left.className="left";
      const icon=document.createElement("div"); icon.className="icon";
      icon.innerHTML = `<img src="${ASSETS.zones[z.id]}" style="filter:${unlocked?"none":"grayscale(100%) brightness(.7)"}">`;

      const text=document.createElement("div");
      text.innerHTML = `<div style="font-weight:1000;">${z.title}</div><div class="small">${unlocked?"UNLOCKED":"LOCKED"} ‚Ä¢ need ${z.need}</div>`;

      left.appendChild(icon); left.appendChild(text);

      const tag=document.createElement("span");
      tag.className="tag";
      tag.textContent = unlocked ? "UNLOCKED" : `LOCKED (${z.need})`;

      node.appendChild(left); node.appendChild(tag);
      el.appendChild(node);
    });
  }

  function gradeDay(){
    const pass = isPassDay();
    state.days[TODAY].result = pass ? "PASS" : "FAIL";
    state.streak = pass ? (state.streak+1) : 0;
    save();
    updateHeader();
    renderMap();
    toast(pass ? "PASS! Streak +1" : "FAIL. Streak reset");
  }

  document.querySelectorAll("#ww .nav button").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      document.querySelectorAll("#ww .nav button").forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");
      const id = btn.dataset.section;
      document.getElementById(id).scrollIntoView({behavior:"smooth", block:"start"});
    });
  });

  $("goTracker").addEventListener("click", ()=>document.getElementById("tracker").scrollIntoView({behavior:"smooth"}));
  $("gradeDay").addEventListener("click", gradeDay);
  $("resetToday").addEventListener("click", ()=>{
    state.days[TODAY]={ tasks:Object.fromEntries(TASKS.map(t=>[t.id,false])), result:"Not graded" };
    save(); renderTasks(); updateHeader(); renderMap(); toast("Today reset");
  });

  // INIT
  applyAssets();
  renderTasks();
  renderMap();
  updateHeader();
</script>

</body>
</html>
